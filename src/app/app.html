<div class="app-container" [class.dark-theme]="isDarkMode" [class.mobile-menu-open]="showMobileMenu">
  <!-- Global Loading Indicator -->
  <div class="global-loading" *ngIf="isLoading">
    <div class="loading-bar"></div>
  </div>

  <!-- Sync Status Indicator -->
  <div class="sync-indicator" *ngIf="showSyncIndicator" [ngClass]="{ 'offline': !syncStatus?.isOnline }">
    <div class="sync-content">
      <span class="sync-icon">
        <span *ngIf="syncStatus?.isOnline && syncStatus?.pendingSync">ðŸ”„</span>
        <span *ngIf="!syncStatus?.isOnline">ðŸ“¶</span>
      </span>
      <span class="sync-text">
        {{ !syncStatus?.isOnline ? 'Working Offline' : 'Syncing...' }}
      </span>
      <button class="sync-retry" *ngIf="syncStatus?.syncErrors?.length > 0" (click)="onSyncRetry()">
        Retry
      </button>
    </div>
  </div>

  <!-- Main App Layout -->
  <div class="main-layout" *ngIf="isAuthenticated; else authLayout">
    <!-- Header -->
    <app-header 
      [user]="currentUser"
      [showMobileToggle]="true"
      (mobileMenuToggle)="toggleMobileMenu()"
      (themeToggle)="toggleTheme()"
      (logout)="logout()">
    </app-header>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Sidebar -->
      <app-sidebar 
        [isVisible]="!showMobileMenu"
        [user]="currentUser">
      </app-sidebar>

      <!-- Content Area -->
      <div class="content-area" [class.with-sidebar]="!showMobileMenu">
        <!-- Page Loading -->
        <div class="page-loading" *ngIf="isLoading">
          <app-loading-spinner message="Loading page..."></app-loading-spinner>
        </div>

        <!-- Router Outlet -->
        <router-outlet *ngIf="!isLoading"></router-outlet>
      </div>
    </div>
  </div>

  <!-- Authentication Layout -->
  <ng-template #authLayout>
    <div class="auth-layout">
      <router-outlet></router-outlet>
    </div>
  </ng-template>

  <!-- Global Components -->
  <app-toast-notification></app-toast-notification>
  
  <!-- Mobile Menu Overlay -->
  <div class="mobile-overlay" 
       *ngIf="showMobileMenu" 
       (click)="toggleMobileMenu()"
       appClickOutside
       (clickOutside)="showMobileMenu = false">
  </div>

  <!-- PWA Install Banner -->
  <div class="pwa-banner" *ngIf="showInstallPrompt">
    <div class="banner-content">
      <span class="banner-icon">ðŸ“±</span>
      <div class="banner-text">
        <div class="banner-title">Install LMS App</div>
        <div class="banner-subtitle">Get the full experience</div>
      </div>
      <button class="install-btn" (click)="installPWA()">Install</button>
      <button class="close-banner" (click)="dismissInstallPrompt()">Ã—</button>
    </div>
  </div>
</div>